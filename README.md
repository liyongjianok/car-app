
# Car-App (懂车小助手 - 汽车资讯后端服务)

基于 Go-Zero 微服务框架开发的高性能汽车资讯平台后端（对标“懂车帝”）。提供包括用户鉴权及安全升级、复杂的车辆多条件检索、海量车型配置 JSON 动态解析、互动车评以及用户收藏夹等完整的全栈闭环功能。

## 🌟 最新核心特性

* **海量真实数据** ：内置 13 个国内外主流汽车品牌、47 个热门车系、近 100 款具体车型（涵盖小米 SU7、仰望 U8、理想 L9、特斯拉等真实参数及多图预览）。
* **企业级安全认证** ：采用 JWT 鉴权体系，并引入 **Bcrypt** 算法。针对历史明文密码实现了商业级的**“平滑升级（懒迁移）”**策略，用户登录时无感完成密文加密替换。
* **前后端数据联动** ：实现侧边栏品牌库的动态拉取与右侧车型的精确按需加载。
* **互动闭环体系** ：包含用户注册、登录、修改资料、发布评价、查看我的评价、一键收藏/取消收藏车辆等完整用户侧闭环。

## 🛠 技术栈

* **核心框架** : Golang 1.21+ / Go-Zero (REST API 架构)
* **数据库** : MySQL 8.0 (利用 JSON 类型支持灵活的车辆配置树，支持海量数据存储)
* **缓存** : Redis 7.0 (利用 go-zero 内置的 sqlc 实现底层查询自动缓存，极大提升响应速度)
* **加密策略** : golang.org/x/crypto/bcrypt (具备随机盐值的不可逆哈希加密)
* **鉴权体系** : JWT (JSON Web Token)

## 📁 目录结构说明

**Plaintext**

```
car-app/
├── deploy/         # 数据库初始化及部署脚本 (init.sql 包含近百款车型海量数据)
├── etc/            # 服务 YAML 配置文件
├── internal/
│   ├── config/     # 配置结构映射
│   ├── handler/    # HTTP 请求路由与参数接收
│   ├── logic/      # 核心业务逻辑实现 (Bcrypt加密、联表查询、JSON解析等)
│   ├── model/      # goctl 自动生成的带缓存的数据库操作层 (含自定义扩展 SQL)
│   ├── svc/        # 服务上下文，注入 DB 连接池与各层 Model
│   └── types/      # 前后端交互的数据结构定义
├── car.api         # goctl API 接口契约定义文件
└── car.go          # 服务启动主入口
```

## 🚀 快速启动指引

### 1. 环境准备 (Docker)

确保已安装 Docker Desktop，运行根目录下的环境编排启动 Redis/MySQL：

**Bash**

```
docker-compose up -d
```

> *注：如果您本地已有 MySQL 服务占用了 3306 端口，可以直接使用本地 MySQL，只需保证 Docker 中的 Redis 正常启动即可。*

### 2. 数据库初始化

通过 Navicat 或 DBeaver 连接 MySQL (`127.0.0.1:3306`)：

1. 执行 `deploy/init.sql`。
2. 该脚本会自动创建 `car_db` 数据库及 8 张核心数据表（新增了 `favorites` 收藏表），并注入 13 个品牌、近百款热门车型、JSON 规格参数及用户神评测试数据。
3. **预设测试账号** ：手机号 `13800138000`，密码 `123456`。（ *注：首次登录后，系统会自动将该明文密码平滑升级为 Bcrypt 密文存入数据库* ）。

### 3. 启动服务

在项目根目录运行（首次运行会自动拉取 Bcrypt 等依赖）：

**Bash**

```
go mod tidy
go run car.go
```

服务默认监听 `http://0.0.0.0:8888`。

## 📖 核心接口列表

### 👤 用户与鉴权模块

| **接口路径**        | **方法** | **鉴权** | **描述**                                  |
| ------------------------- | -------------- | -------------- | ----------------------------------------------- |
| `/api/v1/user/register` | POST           | 否             | 新用户注册 (自动进行 Bcrypt 密码加密)           |
| `/api/v1/user/login`    | POST           | 否             | 用户登录 (支持明文验证并平滑升级密文)获取 Token |
| `/api/v1/user/info`     | GET            | **是**   | 获取当前登录用户信息                            |
| `/api/v1/user/update`   | POST           | **是**   | 更新用户昵称、头像                              |

### 🚗 车型检索模块

| **接口路径**          | **方法** | **鉴权** | **描述**                             |
| --------------------------- | -------------- | -------------- | ------------------------------------------ |
| `/api/v1/cars/brands`     | GET            | 否             | 获取全部汽车品牌列表 (支持按 sort 排序)    |
| `/api/v1/cars/search`     | GET            | 否             | 分页检索车型 (支持 brandId 联动及条件筛选) |
| `/api/v1/cars/detail/:id` | GET            | 否             | 获取带 JSON 属性树的车型详情及多媒体图集   |

### 💬 互动评价与收藏模块

| **接口路径**               | **方法** | **鉴权** | **描述**                                    |
| -------------------------------- | -------------- | -------------- | ------------------------------------------------- |
| `/api/v1/cars/reviews`         | GET            | 否             | 获取特定车型的评论列表及打分                      |
| `/api/v1/cars/review`          | POST           | **是**   | 登录用户对特定车型发表车评                        |
| `/api/v1/user/reviews`         | GET            | **是**   | 分页获取当前用户发布的**“我的评价”**历史记录    |
| `/api/v1/user/favorite/add`    | POST           | 是             | 添加车辆到**“我的收藏”** (防重复提交处理)       |
| `/api/v1/user/favorite/remove` | POST           | **是**   | 取消收藏该车辆                                    |
| `/api/v1/user/favorites`       | GET            | **是**   | 分页获取**“我的收藏”**列表 (包含车名、图片联查) |

## ⚠️ 开发注意事项

* **自定义 SQL 查询** : Go-Zero 默认生成的 Model 仅支持主键查询，本项目中针对 `uid` 查询列表、统计等复杂场景均在对应的 `.go` (非 `_gen.go`) 文件中手动实现了带 Cache 的原生扩充查询。
* **缓存重置** : 项目全量开启了 `sqlc` 缓存机制，如果直接在数据库客户端手动修改了数据（如改变车辆价格），接口可能不会立即生效。开发调试阶段可临时通过 Redis 客户端执行 `FLUSHALL` 清空缓存以同步最新数据。
